# Metrics
   
Deux metrics seront utilisés pour testé le modèle: Intersection-Over-Union (IoU, Jaccard Index) and the F1 score (Dice coefficient) 
Références:
* <https://www.jeremyjordan.me/evaluating-image-segmentation-models/>
* <https://towardsdatascience.com/metrics-to-evaluate-your-semantic-segmentation-model-6bcb99639aa2>
 
## Intersection-Over-Union (IoU, Jaccard Index)
Références: 
* <https://scikit-learn.org/stable/modules/generated/sklearn.metrics.jaccard_score.html>

## F1 score (Dice coefficient)
Références:
* <https://scikit-learn.org/stable/modules/generated/sklearn.metrics.f1_score.html>

## Premier script de test 
```
# pip3 install --no-index scikit-learn
# pip3 install --no-index scikit-image
# pip3 install --no-index keras
# pip3 install --no-index tensorflow_gpu
# pip3 install --no-index tensorflow_cpu

from skimage import io
import numpy as np
import os

filename = os.path.join('/home/vincelf/DeepLabv3FineTuning-master/CrackForest/Images', '001.jpg')
im = io.imread(filename)
im.shape
# (320, 480, 3)
im2 = np.expand_dims(im,0)
im2.shape

filename = os.path.join('/home/vincelf/DeepLabv3FineTuning-master/CrackForest/Masks', '001_label.PNG')
mask = io.imread(filename)
mask.shape
m = np.array(mask)
m2 = np.stack((m,)*3,-1)
m2.shape
m3 = np.expand_dims(m2,0)
m3.shape

# Reference: https://www.jeremyjordan.me/evaluating-image-segmentation-models/
intersection = np.logical_and(im2, m3)
union = np.logical_or(im2, m3)
iou_score = np.sum(intersection) / np.sum(union)
iou_score
# 0.011920572916666667

# Reference: https://towardsdatascience.com/metrics-to-evaluate-your-semantic-segmentation-model-6bcb99639aa2
# Both y_true and y_pred are m x r x c x n where m is the number of images, r is the number of rows, c is the number of columns, and n is the number of classes.
from keras import backend as K
def iou_coef(y_true, y_pred, smooth=1):
  intersection = K.sum(K.abs(y_true * y_pred), axis=[1,2,3])
  union = K.sum(y_true,[1,2,3])+K.sum(y_pred,[1,2,3])-intersection
  iou = K.mean((intersection + smooth) / (union + smooth), axis=0)
  return iou
```
